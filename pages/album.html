<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Álbum - Fanscore</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  
  <link rel="stylesheet" href="../styles/globals.css">
  <link rel="stylesheet" href="../styles/layout.css">
  <link rel="stylesheet" href="../styles/components.css">
  <link rel="stylesheet" href="../styles/album.css">
</head>
<body>
  <div id="app">
    <app-layout
        :menu-items="sidebarMenu"
        :user="userProfile"
        :stats="profileStats"
        :actions="profileActions"
        :topbar="topbarConfig"
        :search-value="searchQuery"
        @logout="handleLogout"
        @action-click="handleProfileAction"
        @topbar-action="handleTopbarAction"
        @search="handleSearch"
    >
        <!-- Banner idéntico al álbum -->
        <div class="banner">
          <div class="banner-text">
            <h2>¡Bienvenido de vuelta, Coleccionista!</h2>
            <p>Revisa tu progreso, abre sobres y continúa completando tu álbum. Cada día te acerca más a completar la colección.</p>
            <button @click="openPackModal" :disabled="!canOpenPack" class="banner-button">
              <i class="fas fa-gift"></i> Abrir Sobre ({{ packsAvailable }} disponibles)
            </button>
          </div>
        </div>

        <!-- Estadísticas en grid igual al álbum -->
        <div class="compact-stats">
          <div class="stat-item highlight">
            <h4>Progreso Total</h4>
            <p>{{ progressPercentage }}%</p>
          </div>
          
          <div class="stat-item">
            <h4>Coleccionadas</h4>
            <p>{{ collectedStickers }}</p>
          </div>

          <div class="stat-item">
            <h4>Duplicadas</h4>
            <p>{{ duplicateStickers }}</p>
          </div>

          <div class="stat-item">
            <h4>Sobres</h4>
            <p>{{ packsAvailable }}</p>
          </div>
        </div>

        <!-- Barra de progreso idéntica al álbum -->
        <div class="progress-container">
          <div class="progress-header">
            <h3><i class="fas fa-chart-line"></i> Progreso del Álbum</h3>
            <span>{{ collectedStickers }} / {{ totalStickers }}</span>
          </div>
          <div class="progress-bar">
            <div class="progress" :style="{ width: progressPercentage + '%' }"></div>
          </div>
        </div>

        <!-- Sección de actividad reciente -->
        <div class="horizontal-filters">
          <div class="filter-group">
            <h4><i class="fas fa-bolt"></i> Actividad Reciente</h4>
            <div class="filter-options" style="flex-direction: column; gap: 0.8rem;">
              <div style="display: flex; align-items: center; gap: 0.8rem;">
                <i class="fas fa-plus-circle" style="color: var(--verde);"></i>
                <span>Obtuviste 3 estampitas nuevas</span>
              </div>
              <div style="display: flex; align-items: center; gap: 0.8rem;">
                <i class="fas fa-chart-line" style="color: var(--dorado);"></i>
                <span>Completaste el 5% del álbum</span>
              </div>
              <div style="display: flex; align-items: center; gap: 0.8rem;">
                <i class="fas fa-trophy" style="color: var(--turquesa);"></i>
                <span>Desbloqueaste 2 logros nuevos</span>
              </div>
            </div>
          </div>
          
          <div class="filter-group">
            <h4><i class="fas fa-bullseye"></i> Próximos Objetivos</h4>
            <div class="filter-options" style="flex-direction: column; gap: 0.8rem;">
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <span>Completar primera página</span>
                <span style="color: var(--dorado); font-weight: bold;">80%</span>
              </div>
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <span>Alcanzar nivel 20</span>
                <span style="color: var(--dorado); font-weight: bold;">15/20</span>
              </div>
              <div style="display: flex; justify-content: space-between; align-items: center;">
                <span>Intercambiar estampitas</span>
                <span style="color: var(--dorado); font-weight: bold;">2/5</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Estampitas recientemente obtenidas -->
        <div class="progress-container">
          <div class="progress-header">
            <h3><i class="fas fa-star"></i> Estampitas Recientes</h3>
            <span>Últimas 4 obtenidas</span>
          </div>
          <div class="sticker-grid" style="grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); margin-top: 1rem;">
            <div 
              v-for="sticker in recentStickers" 
              :key="sticker.id" 
              class="sticker obtained"
              @click="openStickerZoom(sticker)"
            >
              <div class="sticker-number">#{{ sticker.number }}</div>
              <div class="duplicates-badge" v-if="sticker.duplicates > 0">
                +{{ sticker.duplicates }}
              </div>
              <img :src="sticker.image" :alt="sticker.name" class="sticker-image">
              <div class="sticker-info">
                <div class="sticker-name">{{ sticker.name }}</div>
                <div class="sticker-team">{{ sticker.team }}</div>
              </div>
            </div>
          </div>
        </div>
      
    </app-layout>
  </div>

  <!-- Incluir componentes -->
  <script src="../components/sidebar-component.js"></script>
  <script src="../components/profile-component.js"></script>
  <script src="../components/layout-component.js"></script>
  <script src="../components/topbar-component.js"></script>
  
  <script>
    // SearchComponent para el topbar
    const SearchComponent = {
      template: `
        <div class="search-container">
          <i class="fas fa-search"></i>
          <input 
            type="text" 
            :placeholder="placeholder"
            :value="modelValue"
            @input="$emit('update:modelValue', $event.target.value)"
          >
        </div>
      `,
      props: {
        placeholder: {
          type: String,
          default: 'Buscar...'
        },
        modelValue: {
          type: String,
          default: ''
        }
      },
      emits: ['update:modelValue']
    };

    const { createApp, ref, computed, onMounted } = Vue;

    // ====================
    // COMPONENTES LOCALES del Dashboard
    // ====================

    // Banner del dashboard (opcional, ya que usamos HTML directo)
    const DashboardBanner = {
      template: `
        <div class="banner">
          <div class="banner-text">
            <h2>¡Bienvenido de vuelta, Coleccionista!</h2>
            <p>Revisa tu progreso, abre sobres y continúa completando tu álbum.</p>
            <button @click="$emit('open-pack')" :disabled="!canOpenPack" class="banner-button">
              <i class="fas fa-gift"></i> Abrir Sobre ({{ packsAvailable }} disponibles)
            </button>
          </div>
        </div>
      `,
      props: ['packsAvailable', 'canOpenPack'],
      emits: ['open-pack']
    };

    // ====================
    // APP VUE
    // ====================

    const app = createApp({
      setup() {
        // Datos reactivos
        const searchQuery = ref('');
        const packsAvailable = ref(3);
        const selectedSticker = ref(null);
        
        // Datos de estampitas (mock)
        const stickers = ref([
          {
            id: 1,
            number: 1,
            name: 'Lionel Messi',
            team: 'Argentina',
            position: 'Delantero',
            image: 'https://images.unsplash.com/photo-1612872087720-bb876e2e67d1?w=300&h=400&fit=crop',
            obtained: true,
            duplicates: 2
          },
          {
            id: 2,
            number: 7,
            name: 'Cristiano Ronaldo',
            team: 'Portugal',
            position: 'Delantero',
            image: 'https://images.unsplash.com/photo-1612872087720-bb876e2e67d1?w=300&h=400&fit=crop',
            obtained: true,
            duplicates: 1
          },
          {
            id: 5,
            number: 11,
            name: 'Kylian Mbappé',
            team: 'Francia',
            position: 'Delantero',
            image: 'https://images.unsplash.com/photo-1612872087720-bb876e2e67d1?w=300&h=400&fit=crop',
            obtained: true,
            duplicates: 3
          },
          {
            id: 10,
            number: 3,
            name: 'Sergio Ramos',
            team: 'España',
            position: 'Defensa',
            image: 'https://images.unsplash.com/photo-1612872087720-bb876e2e67d1?w=300&h=400&fit=crop',
            obtained: true,
            duplicates: 2
          }
        ]);

        // Computed properties
        const totalStickers = computed(() => 200); // Total fijo para el ejemplo
        const collectedStickers = computed(() => stickers.value.filter(s => s.obtained).length);
        const duplicateStickers = computed(() => {
          return stickers.value.reduce((total, sticker) => total + sticker.duplicates, 0);
        });
        const progressPercentage = computed(() => Math.round((collectedStickers.value / totalStickers.value) * 100));
        const canOpenPack = computed(() => packsAvailable.value > 0);
        const recentStickers = computed(() => stickers.value.slice(0, 4)); // Últimas 4 estampitas

        // Menu del sidebar
        const sidebarMenu = ref([
          { name: 'Dashboard', link: 'dashboard.html', icon: 'fas fa-home', active: false },
          { name: 'Álbum', link: 'album.html', icon: 'fas fa-book', active: true },
          { name: 'Enciclopedia', link: 'enciclopedia.html', icon: 'fas fa-globe', active: false },
          { name: 'Sobres', link: 'sobres.html', icon: 'fas fa-gift', active: false },
          { name: 'Configuración', link: '#', icon: 'fas fa-cog', active: false }
        ]);

        // Perfil del usuario
        const userProfile = ref({
          avatar: 'https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?w=150&h=150&fit=crop&crop=face',
          username: '@UsuarioFan',
          level: 15
        });

        // Stats del perfil
        const profileStats = ref([
          { label: 'Álbum', value: '65% completado' },
          { label: 'Cromos', value: '7/10' },
          { label: 'Duplicados', value: '9' },
          { label: 'Sobres', value: '3' }
        ]);

        // Acciones del perfil
        const profileActions = ref([
          { name: 'Mi Perfil', icon: 'fas fa-user' },
          { name: 'Intercambios', icon: 'fas fa-exchange-alt' }
        ]);

        // Topbar config
        const topbarConfig = ref({
          searchPlaceholder: 'Buscar estampitas, jugadores...',
          actions: [
            { name: 'notifications', icon: 'fas fa-bell', title: 'Notificaciones' },
            { name: 'settings', icon: 'fas fa-cog', title: 'Configuración' }
          ]
        });

        // Métodos
        const openPackModal = () => {
          if (packsAvailable.value > 0) {
            console.log('🎁 Abriendo sobre...');
            packsAvailable.value--;
            // Aquí iría la lógica para abrir el modal de sobres
            alert('¡Sobre abierto! Obtuviste 5 estampitas nuevas.');
          }
        };

        const openStickerZoom = (sticker) => {
          selectedSticker.value = sticker;
          // Aquí podrías abrir un modal para ver la estampita en detalle
          console.log('Ver estampita:', sticker);
        };

        const handleLogout = () => {
          console.log('Cerrando sesión...');
        };

        const handleProfileAction = (actionName) => {
          console.log('Acción del perfil:', actionName);
        };

        const handleTopbarAction = (action) => {
          console.log('Acción topbar:', action);
        };

        const handleSearch = (value) => {
          console.log('Buscando:', value);
        };

        return {
          // Datos
          searchQuery,
          packsAvailable,
          selectedSticker,
          stickers,
          
          // Computed
          totalStickers,
          collectedStickers,
          duplicateStickers,
          progressPercentage,
          canOpenPack,
          recentStickers,
          
          // Datos del layout
          sidebarMenu,
          userProfile,
          profileStats,
          profileActions,
          topbarConfig,
          
          // Métodos
          openPackModal,
          openStickerZoom,
          handleLogout,
          handleProfileAction,
          handleTopbarAction,
          handleSearch
        };
      }
    });

    // ====================
    // REGISTRAR COMPONENTES
    // ====================

    // Componentes globales
    app.component('sidebar-main', SidebarComponent);
    app.component('profile-sidebar', ProfileComponent);
    app.component('app-layout', LayoutComponent);
    app.component('topbar-component', TopbarComponent);
    app.component('search-component', SearchComponent);

    // Componentes locales del dashboard
    app.component('dashboard-banner', DashboardBanner);

    app.mount('#app');
  </script>
</body>
</html>